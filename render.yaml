services:
  - type: web
    name: careerlens-api
    runtime: python
    pythonVersion: "3.11"
    buildCommand: pip install -r requirements.txt
    startCommand: >
      cd backend &&
      uvicorn main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: DATABASE_URL
        fromDatabase:
          name: careerlens-db
          property: connectionString
      - key: ALEMBIC_DATABASE_URL
        fromDatabase:
          name: careerlens-db
          property: connectionString
      - key: CORS_ORIGINS
        value: "https://careerlens-web.onrender.com"
      - key: PINECONE_API_KEY
        sync: false
      - key: PINECONE_INDEX_NAME
        value: "careerlens"
      - key: PINECONE_NAMESPACE
        value: "recommendations"
    healthCheckPath: /api/v1/health
    memoryMB: 512
    numInstances: 1
    autoDeploy: true
    routes:
      - type: http
        path: /api
        destination: http://localhost:8000/api

  - type: web
    name: careerlens-web
    runtime: node
    nodeVersion: "20"
    buildCommand: >
      cd frontend &&
      npm ci &&
      npm run build
    startCommand: >
      cd frontend &&
      npx serve -s dist -l 3000
    envVars:
      - key: VITE_API_BASE_URL
        value: "https://careerlens-api.onrender.com/api/v1"
    healthCheckPath: /
    memoryMB: 256
    numInstances: 1
    autoDeploy: true

  - type: pserv
    name: careerlens-db
    plan: standard
    postgresVersion: "16"
    ipAllowList: []

databases:
  - name: careerlens-db
    databaseName: careerlens
    user: postgres
